<h2>Patient Reports</h2>
<table border="1" style="width:100%; text-align:left;">
  <thead>
    <tr>
      <th>Hospital Code</th>
      <th>Patient ID</th>
      <th>Patient Name</th>
      <th>Report Name</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let report of patientList">
      <td>{{ report.hospitalCode }}</td>
      <td>{{ report.patientId }}</td>
      <td>{{ report.patientName }}</td>
      <td>{{ getReportName(report.reportId) }}</td>
      <td><button (click)="ViewReport(report)">View Report</button></td>
    </tr>
  </tbody>
</table>

<div *ngIf="selectedReport" class="popup">
  <div class="popup-content">
    <span class="close" (click)="closePopup()">&times;</span>
    <h2>Report for {{ selectedPatient.patientName }} ({{ selectedReport.reportName }})</h2>
    <div id="printableArea">

      <div class="patient-info">
        <div class="patient-info-left">
          <p><strong>Patient Name:</strong> {{ selectedPatient.patientName }}</p>
          <p><strong>Age:</strong> {{ selectedPatient.age }} years</p>
          <p><strong>Gender:</strong> {{ selectedPatient.gender }}</p>
        </div>
        <div class="patient-info-right">
          <p><strong>Contact:</strong> {{ selectedPatient.contact }}</p>
          <p><strong>Address:</strong> {{ selectedPatient.address }}</p>
          <p><strong>Date of Birth:</strong> {{ selectedPatient.dateOfBirth }}</p>
        </div>
      </div>
      <hr>
      <div class="report-details">
        <p><strong>Test Performed On:</strong> {{ selectedReport.reportData.testDetails.testPerformedOn }}</p>
        <p><strong>Referred By:</strong> {{ selectedReport.reportData.testDetails.referredBy }}</p>
        <p><strong>Clinical History:</strong> {{ selectedReport.reportData.clinicalHistory }}</p>
        <p><strong>Procedure Details:</strong> {{ selectedReport.reportData.procedureDetails }}</p>
        <p><strong>Findings:</strong></p>
        <ul>
          <li *ngFor="let key of objectKeys(selectedReport.reportData.findings)">
            <strong>{{ key }}:</strong> {{ selectedReport.reportData.findings[key] }}
          </li>
        </ul>
        <p><strong>Impression:</strong> {{ selectedReport.reportData.impression }}</p>
        <p><strong>Recommendations:</strong> {{ selectedReport.reportData.recommendations }}</p>
      </div>
      <hr>
      <div class="doctor-info-container">
        <div class="doctor-info" *ngFor="let doctor of selectedDoctors; let i = index">
          <p><img [src]="doctor.digitalSignature" class="signature-img"></p>
          <p><strong>Doctor:</strong> {{ doctor.doctorName }}</p>
          <p><strong>NMC No:</strong> {{ doctor.nmcNumber }}</p>
          <p><strong>Dept:</strong> {{ doctor.department }}</p>
          <button (click)="removeDoctor(i)">Remove</button>
        </div>
      </div>
    </div>
    <div class="footer">
      <label for="doctorSelect">Select Doctor:</label>
      <select id="doctorSelect" (change)="addDoctor($event)">
        <option value="" disabled selected>Select a doctor</option>
        <option *ngFor="let doctor of doctorList" [value]="doctor.doctorName">{{ doctor.doctorName }}</option>
      </select>
      <button (click)="printReport()">Print</button>
    </div>
  </div>
</div>

<router-outlet></router-outlet>